(function(a){a.fn.unibox=function(b){var d=this;var c=a.extend({suggestUrl:"",queryVisualizationHeadline:"",highlight:true,throttleTime:300,animationSpeed:300,instantVisualFeedback:"all",enterCallback:undefined,minChars:3,maxWidth:d.outerWidth()},b);UniBox.init(d,c);return this}}(jQuery));var UniBox=function(){var b=-1;var g;var s;var p="";var k;var c=[];var d=true;var r=300;var j="";var l=2;var i;var n=[];var m="all";function f(u){if(u!==undefined){var v=g.val();if(u.keyCode==9||u.keyCode==13||v.length<l){s.slideUp(r);b=-1}}else{s.slideUp(r);b=-1}}function e(v,u){var w=null;return function(){var y=this,x=arguments;clearTimeout(w);w=window.setTimeout(function(){v.apply(y,x)},u||500)}}function q(v,u){if(!d){return v}var x=u.split(" ");var w={};$.each(x,function(y,z){if(z.length<2){return}v=v.replace(new RegExp(z,"gi"),"##"+y+"##");w["##"+y+"##"]="<span>"+z+"</span>"});$.each(w,function(y,z){v=v.replace(new RegExp(y,"gi"),z)});return v}function t(v){var u=g.val();s.html("");$.each(v.suggests,function(x,w){if(x.replace(/_/,"").length>0&&w.length>0){var y=$("<h4>"+x+"</h4>");s.append(y)}$.each(w,function(z,C){var A='<div class="unibox-selectable">';if(C.image!=undefined){A+='<div class="unibox-selectable-img-container"><img src="'+C.image+'"/></div>'}if(C.link!=undefined){A+='<a href="'+C.link+'">';A+=q(C.name,u);A+="</a>"}else{A+=q(C.name,u)}A+='<div class="unibox-ca"></div></div>';var B=$(A);s.append(B)})});$(".unibox-selectable").click(function(){g.val($(this).text());i($(this).text());f()});if(v.words.length>0&&j.length>0&&(m=="all"||m=="bottom")){s.append("<h4>"+j+"</h4>")}$.each(v.words,function(x,A){if((m=="all"||m=="bottom")){if(A.overlayImage!=undefined){s.append('<img class="unibox-vis" src="'+A.overlayImage+'" style="background-image: url(\''+A.image+"');background-size: 75%;background-repeat: no-repeat;background-position: center;\">")}else{s.append('<img class="unibox-vis" src="'+A.image+'">')}}var z=$("#unibox-invisible");z.html(u.replace(new RegExp(A.name,"gi"),"<span>"+A.name+"</span>"));if((m=="all"||m=="top")&&jQuery.inArray(A.image,n)==-1){var y=$("#unibox-invisible span")[0];if(y!=undefined&&A.name.length>0){var w=$(y).position().left;visImage=$('<div class="unibox-ivf"><img src="'+A.image+'" alt="'+A.name+'"></div>');visImage.css("left",g.offset().left+w-10);visImage.css("top",g.offset().top-80);$("body").append(visImage);setTimeout(function(){$(".unibox-ivf").find("img").addClass("l")},10)}n.push(A.image)}});$("img").error(function(){$(this).hide()});s.css("left",g.offset().left);s.css("top",g.offset().top+g.outerHeight());s.slideDown(r,function(){s.css("left",g.offset().left);s.css("top",g.offset().top+g.outerHeight())});c=$(".unibox-selectable");b=-1}function a(){n=[];$(".unibox-ivf").remove()}function h(v){if(g.val().length<=1){a()}if(v.keyCode!=38&&v.keyCode!=40&&v.keyCode!=13){if(v.keyCode==46||v.keyCode==8){a()}return}if(v.keyCode==38&&b>0){b--}else{if(v.keyCode==40){b++}}if(c.length>0){b=b%c.length;c.removeClass("active");var u=$(c[b]);u.addClass("active")}if(v.keyCode==13){if(i!=undefined){var w=g.val();if(b!=-1){w=$($(".unibox-selectable.active")[0]).text()}i(w)}else{if(b!=-1){window.location.href=$($(".unibox-selectable.active")[0]).find("a").attr("href")}}return false}}function o(u){if(u.keyCode==38||u.keyCode==40||u.keyCode==13){return}var v=g.val();if(v.length>=l){$.ajax(p+encodeURIComponent(v),{dataType:"json",success:function(w){t(w)}})}}return{init:function(w,u){g=w;d=u.highlight;p=u.suggestUrl;k=u.throttleTime;r=u.animationSpeed;l=u.minChars;i=u.enterCallback;m=u.instantVisualFeedback;j=u.queryVisualizationHeadline;g.attr("autocomplete","off");s=$('<div id="unibox-suggest-box"></div>');$("body").append(s);s.css("min-width",g.outerWidth());s.css("max-width",u.maxWidth);g.keydown(h);g.keydown(e(o,k));g.keydown(f);g.keyup(f);$("html").click(function(){s.slideUp(r)});s.click(function(x){x.stopPropagation()});var v=$('<div id="unibox-invisible">text whatever <span>this one</span></div>');g.parent().append(v);console.log("unibox initialized")}}}();